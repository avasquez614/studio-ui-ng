<h2>
  <span *ngIf="editMode">Editing {{model.firstName}} {{model.lastName}}</span>
  <span *ngIf="!editMode">New User</span>
</h2>

<mat-tab-group [dynamicHeight]="true" [(selectedIndex)]="selectedTabIndex">
  <mat-tab i18n-label label="Basic Information">

    <!-- Read only user view -->
    <div class="tab-content pad x" *ngIf="model.managedExternally">

      <div class="ui icon message">
        <i class="info icon"></i>
        <div class="content">
          <h3 class="header" i18n>Externally Managed</h3>
          <p i18n>This user is managed externally and cannot be edited from Studio.</p>
        </div>
      </div>

      <table class="ui definition very basic table">
        <tbody>
        <tr>
          <td class="text-right" i18n>Username</td>
          <td>{{model.username}}</td>
        </tr>
        <tr>
          <td class="text-right" i18n>First name</td>
          <td>{{model.firstName}}</td>
        </tr>
        <tr>
          <td class="text-right" i18n>Last name</td>
          <td>{{model.lastName}}</td>
        </tr>
        <tr>
          <td class="text-right" i18n>Email</td>
          <td>{{model.email}}</td>
        </tr>
        <tr>
          <td class="text-right" i18n>Enabled</td>
          <td>{{model.enabled ? 'Yes' : 'No'}}</td>
        </tr>
        </tbody>
      </table>

    </div>

    <!-- User edit form -->
    <div class="tab-content pad x"  *ngIf="!model.managedExternally">

      <div class="mat-form-fields">

        <div class="two">
          <div *ngIf="editMode">
            <div><strong i18n>Username</strong></div> <span>{{model.username}}</span>
          </div>
          <mat-form-field *ngIf="!editMode">
            <input matInput i18n-placeholder placeholder="Username"
                   [(ngModel)]="model.username"
                   [formControl]="userNameFormControl">
            <mat-error i18n *ngIf="userNameFormControl.hasError('required')">
              Email address is <strong>required</strong>
            </mat-error>
          </mat-form-field>
          <div class="avatar-display">
            <div class="selected-avatar">
              <div class="ui tiny image">
                <img *ngIf="model.avatarUrl" [src]="model.avatarUrl" alt="">
              </div>
            </div>
            <div class="available-avatars">
              <div class="ui mini image" [class.active]="avatar === model.avatarUrl" *ngFor="let avatar of avatars" (click)="model.avatarUrl = avatar">
                <img *ngIf="avatar" [src]="avatar" alt="">
              </div>
            </div>
          </div>
        </div>

        <div class="two">
          <mat-form-field>
            <input matInput i18n-placeholder placeholder="First Name"
                   [(ngModel)]="model.firstName"
                   [formControl]="firstNameFormControl">
            <mat-error i18n *ngIf="firstNameFormControl.hasError('required')">
              First name is <strong>required</strong>
            </mat-error>
          </mat-form-field>
          <mat-form-field>
            <input matInput i18n-placeholder placeholder="Last Name"
                   [(ngModel)]="model.lastName"
                   [formControl]="lastNameFormControl">
            <mat-error i18n *ngIf="lastNameFormControl.hasError('required')">
              Last name is <strong>required</strong>
            </mat-error>
          </mat-form-field>
        </div>

        <mat-form-field>
          <input matInput i18n-placeholder placeholder="Email"
                 [(ngModel)]="model.email"
                 [formControl]="emailFormControl">
          <mat-error i18n *ngIf="emailFormControl.hasError('pattern')">
            Please enter a valid email address
          </mat-error>
          <mat-error i18n *ngIf="emailFormControl.hasError('required')">
            Email address is <strong>required</strong>
          </mat-error>
        </mat-form-field>

        <div *ngIf="!editMode" class="">
          <div>
            <std-password-field [model]="model" [formControlRef]="passwordFormControl" [autoGenerate]="true"></std-password-field>
            <span class="ui plain small right floated message">
                A password was auto-generated for you <i class="icon smile"></i>
              </span>
          </div>
          <div>

          </div>
        </div>

        <div *ngIf="editMode" class="two">
          <div><mat-checkbox i18n [(ngModel)]="model.enabled" (change)="enabledChanged($event.checked)">Enabled</mat-checkbox></div>
          <div></div>
        </div>

      </div>

    </div>

  </mat-tab>
  <mat-tab i18n-label label="Password Management" [disabled]="!editMode" *ngIf="!model.managedExternally">
    <div class="tab-content pad x" *ngIf="editMode">

      <div class="mat-form-fields">
        <std-password-field [model]="model" [formControlRef]="resetPasswordFormControl"></std-password-field>
      </div>

      <div class="pad y">
        <mat-checkbox i18n [(ngModel)]="notifyPasswordReset">Send email notification</mat-checkbox>
      </div>

    </div>
  </mat-tab>
  <mat-tab i18n-label label="Projects & Groups" [disabled]="!editMode">
    <div class="tab-content pad x" *ngIf="editMode">

      <std-user-group-manager
        *ngIf="selectedTabIndex === 2"
        (change)="userGroupsChanged($event)"
        [changeRollBack]="groupChangeRollback"
        [user]="model"></std-user-group-manager>

    </div>
  </mat-tab>
</mat-tab-group>

<div fxLayout="row" fxLayoutAlign="space-between center">
  <div>
    <ng-container *ngIf="!model.managedExternally">
      <button mat-raised-button
              color="warn"
              *ngIf="selectedTabIndex === 1"
              (click)="resetPassword()"
              [disabled]="!resetPasswordFormControl.valid">
        <span class="white text">Reset Password</span>
      </button>
      <button mat-raised-button
              class="blue background"
              (click)="update()"
              [disabled]="!updateBasicInfoFormGroup.valid"
              *ngIf="editMode && !model.managedExternally && (selectedTabIndex === 0)">
        <span i18n class="white text">Update</span>
      </button>
    </ng-container>
    <button mat-raised-button class="green background"
            (click)="create()"
            [disabled]="!updateBasicInfoFormGroup.valid || !passwordFormControl.valid"
            *ngIf="!editMode">
      <span i18n class="white text">Create</span>
    </button>
    <button mat-button (click)="done()" tabindex="2">Done</button>
  </div>
  <ng-container *ngIf="editMode">
    <button mat-fab color="warn" [matMenuTriggerFor]="deleteConfirm" [attr.aria-label]="'Delete User' | i18n">
      <mat-icon class="white text">delete</mat-icon>
    </button>
  </ng-container>
</div>
<mat-menu #deleteConfirm="matMenu">
  <button mat-menu-item>Cancel</button>
  <button mat-menu-item [matMenuTriggerFor]="deleteOptions"><i class="warning icon"></i> Confirm Deletion?</button>
</mat-menu>
<mat-menu #deleteOptions="matMenu">
  <button mat-menu-item (click)="eliminate()">Yes, permanently delete user.</button>
</mat-menu>

<!--
        <form class="ui form">
          <div class="field">
            <label>Username</label>
            <input type="text" required [(ngModel)]="model.username">
          </div>
          <div class="field">
            <div class="two fields">
              <div class="field">
                <label>First Name</label>
                <input type="text" [(ngModel)]="model.firstName" required>
              </div>
              <div class="field">
                <label>Last Name</label>
                <input type="text" [(ngModel)]="model.lastName" required>
              </div>
            </div>
          </div>
          <div class="field">
            <label>Email Address</label>
            <input type="text" required>
          </div>
          <div class="field">
            <label>Password</label>
            <input type="text" required>
          </div>
        </form>
        -->

<!--
<input id="name" name="name" class="form-control"
       required minlengtd="4" forbiddenName="bob"
       [(ngModel)]="hero.name" #name="ngModel" >

<div *ngIf="passwordField.invalid && (passwordField.dirty || passwordField.touched)"
     class="alert alert-danger">

  <div *ngIf="name.errors.required">
    Name is required.
  </div>
  <div *ngIf="name.errors.minlengtd">
    Name must be at least 4 characters long.
  </div>
  <div *ngIf="name.errors.forbiddenName">
    Name cannot be Bob.
  </div>

</div>
-->
